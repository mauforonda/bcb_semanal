<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.3">
<title>BCB Semanal</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,ocean-floor.323f29fe.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,ocean-floor.323f29fe.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.6d4b40e3.js">
<link rel="modulepreload" href="./_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="./_observablehq/stdlib.73a8ec5a.js">
<link rel="modulepreload" href="./_npm/hyparquet@1.23.0/1464c187.js">
<link rel="modulepreload" href="./_npm/hyparquet-compressors@1.1.1/27427de5.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/e780feca.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.4ef1d259.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.17/d761ef9b.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/72f4716c.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/18cbf477.js">
<link rel="modulepreload" href="./_npm/fzstd@0.1.1/18ba7f4e.js">
<link rel="modulepreload" href="./_npm/hysnappy@1.0.0/aa6d89aa.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e93ca09f.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/0f2de24d.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/65eb105b.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/7ef8fb2e.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/aeb57b94.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/1d2aed74.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/5ced1d52.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/9ba9c7f3.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/4202580c.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/9cffc2bd.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/cdd7e898.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/b4e2ad9a.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e804d15.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/86074ef6.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/40599fb3.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/e49e792c.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/8d1e5425.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/20d3f133.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/7553081f.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/0dfd751c.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/3c90ee06.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/843b6a76.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/ba24c2e7.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/4d94e5b7.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/6d3a6726.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/9f03c579.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/07c9626f.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/b58a267d.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/004da2ac.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/b5786b3f.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/53fe8176.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/e08981d9.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/02d43215.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/cbf6ba23.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/aa00730b.js">
<link rel="icon" href="https://mauforonda.github.io/images/icon.svg" type="image/svg" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.6d4b40e3.js";

define({id: "045f09ba", outputs: ["hyparquet","compressors"], body: async () => {
const [hyparquet, compressors] = await Promise.all([import("./_npm/hyparquet@1.23.0/1464c187.js"), import("./_npm/hyparquet-compressors@1.1.1/27427de5.js")]);

return {hyparquet,compressors};
}});

define({id: "eecc0d5c", inputs: ["Generators"], outputs: ["dark"], body: (Generators) => {
const dark = Generators.dark();
return {dark};
}});

define({id: "84c4a1e4", outputs: ["gh"], body: () => {
const gh =
  "https://raw.githubusercontent.com/mauforonda/bcb_semanal/refs/heads/main/";
return {gh};
}});

define({id: "9df6fd3d", inputs: ["gh","hyparquet","compressors"], outputs: ["arrayBuffer","data"], body: async (gh,hyparquet,compressors) => {
const arrayBuffer = await fetch(`${gh}/datos.parquet`).then((d) =>
  d.arrayBuffer()
);

const data = await new Promise((resolve) =>
  hyparquet.parquetRead({
    file: arrayBuffer,
    compressors: compressors.compressors,
    onComplete: (raw) => {
      const processed = raw.map((arr) => ({
        unidad: arr[0],
        categoria: arr[1],
        variable: arr[2],
        subvariable: arr[3],
        fecha: arr[4],
        valor: arr[5],
      }));
      resolve(processed);
    },
  })
);
return {arrayBuffer,data};
}});

define({id: "171d4dcc", inputs: ["d3","data"], outputs: ["variables"], body: (d3,data) => {
const variables = Object.fromEntries(
  d3.rollup(
    data,
    (v) => [...new Set(v.map((d) => d.variable))],
    (d) => d.categoria
  )
);
return {variables};
}});

define({id: "58ac8938", inputs: ["Inputs","variables","Generators"], outputs: ["categoria_input","categoria"], body: (Inputs,variables,Generators) => {
const categoria_input = Inputs.radio(Object.keys(variables), {
  value: "Operaciones con el exterior",
});
const categoria = Generators.input(categoria_input);
return {categoria_input,categoria};
}});

define({id: "b5f393b7", inputs: ["Inputs","variables","categoria","Generators"], outputs: ["variable_input","variable"], body: (Inputs,variables,categoria,Generators) => {
const variable_input = Inputs.radio(variables[categoria], {
  value: variables[categoria][0],
});
const variable = Generators.input(variable_input);
return {variable_input,variable};
}});

define({id: "5b1a625e", inputs: ["dark"], outputs: ["light_colors","dark_colors","colors","formatoFecha"], body: (dark) => {
const light_colors = {
  frame: "#a2a2a2",
  background: "#eff4f4",
  line: "#555555",
  fill: "#d3d8da",
  focus_primary: "#6c95bdff",
  focus_secondary: "#adc0d3ff",
};

const dark_colors = {
  frame: "#757684ff",
  background: "#212132ff",
  line: "#819acaff",
  fill: "#32344aff",
  focus_primary: "#dfe3f8ff",
  focus_secondary: "#9397c6ff",
};

const colors = dark ? dark_colors : light_colors;

const formatoFecha = new Intl.DateTimeFormat("es", {
  year: "numeric",
  month: "long",
  day: "numeric",
  timeZone: "UTC",
});
return {light_colors,dark_colors,colors,formatoFecha};
}});

define({id: "5853d1b4", inputs: ["d3","colors","Plot","width","formatoFecha"], outputs: ["plot_silueta"], body: (d3,colors,Plot,width,formatoFecha) => {
function plot_silueta(desagregado, height) {
  // const desagregado = data.filter((d) => d.variable == variable);
  const unidad = desagregado[0].unidad;
  const serie = d3
    .rollups(
      desagregado,
      (v) => d3.sum(v, (d) => d.valor),
      (d) => d.fecha
    )
    .map(([fecha, valor]) => ({ fecha, valor }));

  const params = {
    axis: {
      fontWeight: 600,
      fontSize: 12,
      tickSize: 0,
      label: null,
    },
    text_secondary: {
      fontWeight: 600,
      fontSize: 12,
      fill: colors.focus_secondary,
    },
    text_primary: {
      fontWeight: 800,
      fontSize: 20,
      fill: colors.focus_primary,
    },
  };

  const miles = Math.max(...serie.map((d) => d.valor)) > 1e4;
  const formatter = miles ? (d) => d / 1e3 : (d) => d;
  const suffix = miles ? "mil" : "";

  const tickFormat = (d, i, _) =>
    i === _.length - 1
      ? `${formatter(d)} ${suffix}`
      : d === 0
      ? ""
      : formatter(d);

  const default_pointer = (
    index,
    scales,
    values,
    dimensions,
    context,
    next
  ) => {
    const i = index.length > 0 ? index[0] : serie.length - 1;
    return next([i], scales, values, dimensions, context);
  };

  const follow_pointer = (index, scales, values, dimensions, context, next) => {
    const i = index.length > 0 ? index[0] : serie.length - 1;
    const X = values.x ?? values.x1;
    const x0 = X[i];
    const newIndex = Array.from(X, (_, i) => i).filter((i) => X[i] <= x0);
    return next(newIndex, scales, values, dimensions, context);
  };

  const plot = Plot.plot({
    className: "plot",
    height: width < 768 ? 350 : 550,
    width: width < 768 ? width : 980,
    marginTop: 70,
    marginLeft: 30,
    marginRight: 40,
    marginBottom: 40,
    style: {
      color: colors.frame,
      background: colors.background,
    },
    x: {
      insetRight: 25,
    },
    y: {
      insetTop: 15,
    },
    marks: [
      Plot.axisX({ ...params.axis }),
      Plot.axisY({
        ...params.axis,
        anchor: "right",
        dx: -24,
        dy: 10,
        lineAnchor: "top",
        tickFormat: tickFormat,
      }),
      Plot.ruleY([0], {
        strokeWidth: 1.5,
      }),
      Plot.areaY(serie, {
        x: "fecha",
        y: "valor",
        fill: colors.fill,
        fillOpacity: 0.5,
      }),
      Plot.areaY(
        serie,
        Plot.pointerX({
          x: "fecha",
          y: "valor",
          fill: colors.fill,
          fillOpacity: 1,
          render: follow_pointer,
        })
      ),
      Plot.gridY({
        strokeOpacity: 0.8,
        strokeWidth: 0.7,
        strokeDasharray: "4 3",
      }),
      Plot.line(
        serie,
        Plot.pointerX({
          x: "fecha",
          y: "valor",
          stroke: colors.line,
          strokeWidth: 3,
          render: follow_pointer,
        })
      ),
      Plot.ruleX(
        serie,
        Plot.pointerX({
          x: "fecha",
          py: "valor",
          stroke: colors.line,
          strokeOpacity: 0.8,
          strokeWidth: 2.5,
          strokeDasharray: "4 3",
          render: default_pointer,
        })
      ),
      Plot.dot(
        serie,
        Plot.pointerX({
          x: "fecha",
          y: "valor",
          fill: colors.focus_primary,
          stroke: colors.line,
          strokeWidth: 3,
          r: 6,
          render: default_pointer,
        })
      ),
      Plot.text(
        serie,
        Plot.pointerX({
          text: (d) => formatoFecha.format(d.fecha),
          px: "fecha",
          dy: -30,
          lineAnchor: "bottom",
          textAnchor: "start",
          frameAnchor: "top-left",
          render: default_pointer,
          ...params.text_secondary,
        })
      ),
      Plot.text(
        serie,
        Plot.pointerX({
          text: (d) => d.valor,
          px: "fecha",
          dy: -30,
          dx: -25,
          lineAnchor: "bottom",
          textAnchor: "end",
          frameAnchor: "top-right",
          render: default_pointer,
          ...params.text_primary,
        })
      ),
      Plot.text(
        serie,
        Plot.pointerX({
          text: (d) => unidad,
          dx: -25,
          dy: -20,
          px: "fecha",
          textAnchor: "end",
          frameAnchor: "top-right",
          lineAnchor: "top",
          stroke: colors.background,
          render: default_pointer,
          ...params.text_secondary,
        })
      ),
    ],
  });
  return plot;
}
return {plot_silueta};
}});

define({id: "5f1a2493", outputs: ["download"], body: () => {
function download(value, name = "untitled", label = "Save") {
  const a = document.createElement("a");
  const b = a.appendChild(document.createElement("button"));
  b.textContent = label;
  a.download = name;

  async function reset() {
    await new Promise(requestAnimationFrame);
    URL.revokeObjectURL(a.href);
    a.removeAttribute("href");
    b.textContent = label;
    b.disabled = false;
  }

  a.onclick = async (event) => {
    b.disabled = true;
    if (a.href) return reset(); // Already saved.
    b.textContent = "Savingâ€¦";
    try {
      const object = await (typeof value === "function" ? value() : value);
      b.textContent = "Download";
      a.href = URL.createObjectURL(object); // eslint-disable-line require-atomic-updates
    } catch (ignore) {
      b.textContent = label;
    }
    if (event.eventPhase) return reset(); // Already downloaded.
    b.disabled = false;
  };

  return a;
}
return {download};
}});

define({id: "8ef21806", inputs: ["d3","download"], outputs: ["descarga"], body: (d3,download) => {
function descarga(data, filename, mensaje) {
  const downloadData = new Blob([d3.csvFormat(data)], { type: "text/csv" });
  return download(downloadData, filename, mensaje);
}
return {descarga};
}});

define({id: "e52c6a0c", inputs: ["data","variable","plot_silueta","Inputs","width"], outputs: ["desagregado","silueta","table"], body: (data,variable,plot_silueta,Inputs,width) => {
const desagregado = data.filter((d) => d.variable == variable);
const silueta = plot_silueta(desagregado);
const table = Inputs.table(desagregado, {
  sort: "fecha",
  columns:
    width < 768
      ? ["subvariable", "fecha", "valor", "unidad"]
      : ["variable", "subvariable", "fecha", "valor", "unidad"],
  reverse: true,
  select: false,
});
return {desagregado,silueta,table};
}});

define({id: "a41e297b", mode: "inline", inputs: ["categoria_input","display"], body: async (categoria_input,display) => {
display(await(
categoria_input
))
}});

define({id: "4728b0c3", mode: "inline", inputs: ["variable_input","display"], body: async (variable_input,display) => {
display(await(
variable_input
))
}});

define({id: "3b325109", mode: "inline", inputs: ["variable","display"], body: async (variable,display) => {
display(await(
variable
))
}});

define({id: "3e0a6119", mode: "inline", inputs: ["silueta","display"], body: async (silueta,display) => {
display(await(
silueta
))
}});

define({id: "0d4fc4a7", mode: "inline", inputs: ["table","display"], body: async (table,display) => {
display(await(
table
))
}});

define({id: "56e5bf58", mode: "inline", inputs: ["descarga","desagregado","display"], body: async (descarga,desagregado,display) => {
display(await(
descarga(desagregado, "data.csv", "Descarga esta tabla en formato CSV")
))
}});

</script>
</head>
<body>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<link rel="stylesheet" href="./_file/style.457ba9af.css">
<div class="observablehq observablehq--block"><!--:045f09ba:--></div>
<div class="observablehq observablehq--block"><!--:eecc0d5c:--></div>
<div class="observablehq observablehq--block"><!--:84c4a1e4:--></div>
<div class="observablehq observablehq--block"><!--:9df6fd3d:--></div>
<div class="observablehq observablehq--block"><!--:171d4dcc:--></div>
<div class="observablehq observablehq--block"><!--:58ac8938:--></div>
<div class="observablehq observablehq--block"><!--:b5f393b7:--></div>
<div class="observablehq observablehq--block"><!--:5b1a625e:--></div>
<div class="observablehq observablehq--block"><!--:5853d1b4:--></div>
<div class="observablehq observablehq--block"><!--:5f1a2493:--></div>
<div class="observablehq observablehq--block"><!--:8ef21806:--></div>
<div class="observablehq observablehq--block"><!--:e52c6a0c:--></div>
<cuerpo>
  <header>Reportes del Banco Central del Bolivia</header>
  <menu>
    <categorias><observablehq-loading></observablehq-loading><!--:a41e297b:--></categorias>
    <variables><observablehq-loading></observablehq-loading><!--:4728b0c3:--></variables>
  </menu>
  <grafico>
    <titulo><observablehq-loading></observablehq-loading><!--:3b325109:--></titulo>
    <card><observablehq-loading></observablehq-loading><!--:3e0a6119:--></card>
  </grafico>
  <tabla><observablehq-loading></observablehq-loading><!--:0d4fc4a7:--></tabla>
  <descargas><observablehq-loading></observablehq-loading><!--:56e5bf58:--></descargas>
</cuerpo>
</main>
</div>
</body>
</html>
