/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/hyparquet@1.23.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const e=["BOOLEAN","INT32","INT64","INT96","FLOAT","DOUBLE","BYTE_ARRAY","FIXED_LEN_BYTE_ARRAY"],t=["PLAIN","GROUP_VAR_INT","PLAIN_DICTIONARY","RLE","BIT_PACKED","DELTA_BINARY_PACKED","DELTA_LENGTH_BYTE_ARRAY","DELTA_BYTE_ARRAY","RLE_DICTIONARY","BYTE_STREAM_SPLIT"],n=["REQUIRED","OPTIONAL","REPEATED"],r=["UTF8","MAP","MAP_KEY_VALUE","LIST","ENUM","DECIMAL","DATE","TIME_MILLIS","TIME_MICROS","TIMESTAMP_MILLIS","TIMESTAMP_MICROS","UINT_8","UINT_16","UINT_32","UINT_64","INT_8","INT_16","INT_32","INT_64","JSON","BSON","INTERVAL"],i=["UNCOMPRESSED","SNAPPY","GZIP","LZO","BROTLI","LZ4","ZSTD","LZ4_RAW"],o=["DATA_PAGE","INDEX_PAGE","DICTIONARY_PAGE","DATA_PAGE_V2"],f=["UNORDERED","ASCENDING","DESCENDING"],s=["SPHERICAL","VINCENTY","THOMAS","ANDOYER","KARNEY"];function a(e){const t=l(e);if(1===t.type)return{type:"Point",coordinates:c(e,t)};if(2===t.type)return{type:"LineString",coordinates:u(e,t)};if(3===t.type)return{type:"Polygon",coordinates:d(e,t)};if(4===t.type){const n=[];for(let r=0;r<t.count;r++)n.push(c(e,l(e)));return{type:"MultiPoint",coordinates:n}}if(5===t.type){const n=[];for(let r=0;r<t.count;r++)n.push(u(e,l(e)));return{type:"MultiLineString",coordinates:n}}if(6===t.type){const n=[];for(let r=0;r<t.count;r++)n.push(d(e,l(e)));return{type:"MultiPolygon",coordinates:n}}if(7===t.type){const n=[];for(let r=0;r<t.count;r++)n.push(a(e));return{type:"GeometryCollection",geometries:n}}throw new Error(`Unsupported geometry type: ${t.type}`)}function l(e){const{view:t}=e,n=1===t.getUint8(e.offset++),r=t.getUint32(e.offset,n);e.offset+=4;const i=r%1e3,o=Math.floor(r/1e3);let f=0;i>1&&i<=7&&(f=t.getUint32(e.offset,n),e.offset+=4);let s=2;return o&&s++,3===o&&s++,{littleEndian:n,type:i,dim:s,count:f}}function c(e,t){const n=[];for(let r=0;r<t.dim;r++){const r=e.view.getFloat64(e.offset,t.littleEndian);e.offset+=8,n.push(r)}return n}function u(e,t){const n=[];for(let r=0;r<t.count;r++)n.push(c(e,t));return n}function d(e,t){const{view:n}=e,r=[];for(let i=0;i<t.count;i++){const i=n.getUint32(e.offset,t.littleEndian);e.offset+=4,r.push(u(e,{...t,count:i}))}return r}const _=new TextDecoder,p={timestampFromMilliseconds:e=>new Date(Number(e)),timestampFromMicroseconds:e=>new Date(Number(e/1000n)),timestampFromNanoseconds:e=>new Date(Number(e/1000000n)),dateFromDays:e=>new Date(864e5*e),stringFromBytes:e=>e&&_.decode(e),geometryFromBytes:e=>e&&a({view:new DataView(e.buffer,e.byteOffset,e.byteLength),offset:0}),geographyFromBytes:e=>e&&a({view:new DataView(e.buffer,e.byteOffset,e.byteLength),offset:0})};function h(e,t,n,r){if(t&&n.endsWith("_DICTIONARY")){let n=e;e instanceof Uint8Array&&!(t instanceof Uint8Array)&&(n=new t.constructor(e.length));for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}return y(e,r)}function y(e,t){const{element:n,parsers:r,utf8:i=!0}=t,{type:o,converted_type:f,logical_type:s}=n;if("DECIMAL"===f){const t=10**-(n.scale||0),r=new Array(e.length);for(let n=0;n<r.length;n++)e[n]instanceof Uint8Array?r[n]=m(e[n])*t:r[n]=Number(e[n])*t;return r}if(!f&&"INT96"===o)return Array.from(e).map((e=>{return r.timestampFromNanoseconds(86400000000000n*(((t=e)>>64n)-2440588n)+(0xffffffffffffffffn&t));var t}));if("DATE"===f)return Array.from(e).map((e=>r.dateFromDays(e)));if("TIMESTAMP_MILLIS"===f)return Array.from(e).map((e=>r.timestampFromMilliseconds(e)));if("TIMESTAMP_MICROS"===f)return Array.from(e).map((e=>r.timestampFromMicroseconds(e)));if("JSON"===f)return e.map((e=>JSON.parse(_.decode(e))));if("BSON"===f)throw new Error("parquet bson not supported");if("INTERVAL"===f)throw new Error("parquet interval not supported");if("GEOMETRY"===s?.type)return e.map((e=>r.geometryFromBytes(e)));if("GEOGRAPHY"===s?.type)return e.map((e=>r.geographyFromBytes(e)));if("UTF8"===f||"STRING"===s?.type||i&&"BYTE_ARRAY"===o)return e.map((e=>r.stringFromBytes(e)));if("UINT_64"===f||"INTEGER"===s?.type&&64===s.bitWidth&&!s.isSigned){if(e instanceof BigInt64Array)return new BigUint64Array(e.buffer,e.byteOffset,e.length);const t=new BigUint64Array(e.length);for(let n=0;n<t.length;n++)t[n]=BigInt(e[n]);return t}if("UINT_32"===f||"INTEGER"===s?.type&&32===s.bitWidth&&!s.isSigned){if(e instanceof Int32Array)return new Uint32Array(e.buffer,e.byteOffset,e.length);const t=new Uint32Array(e.length);for(let n=0;n<t.length;n++)t[n]=e[n];return t}if("FLOAT16"===s?.type)return Array.from(e).map(g);if("TIMESTAMP"===s?.type){const{unit:t}=s;let n=r.timestampFromMilliseconds;"MICROS"===t&&(n=r.timestampFromMicroseconds),"NANOS"===t&&(n=r.timestampFromNanoseconds);const i=new Array(e.length);for(let t=0;t<i.length;t++)i[t]=n(e[t]);return i}return e}function m(e){if(!e.length)return 0;let t=0n;for(const n of e)t=256n*t+BigInt(n);const n=8*e.length;return t>=2n**BigInt(n-1)&&(t-=2n**BigInt(n)),Number(t)}function g(e){if(!e)return;const t=e[1]<<8|e[0],n=t>>15?-1:1,r=t>>10&31,i=1023&t;return 0===r?n*2**-14*(i/1024):31===r?i?NaN:n*(1/0):n*2**(r-15)*(1+i/1024)}function w(e,t,n){const r=e[t],i=[];let o=1;if(r.num_children)for(;i.length<r.num_children;){const r=e[t+o],f=w(e,t+o,[...n,r.name]);o+=f.count,i.push(f)}return{count:o,element:r,children:i,path:n}}function A(e,t){let n=w(e,0,[]);const r=[n];for(const e of t){const i=n.children.find((t=>t.element.name===e));if(!i)throw new Error(`parquet schema element not found: ${t}`);r.push(i),n=i}return r}function E(e){let t=0;for(const{element:n}of e)"REPEATED"===n.repetition_type&&t++;return t}function v(e){let t=0;for(const{element:n}of e.slice(1))"REQUIRED"!==n.repetition_type&&t++;return t}function I(e){if(2!==e.length)return!1;const[,t]=e;return"REPEATED"!==t.element.repetition_type&&!t.children.length}const b=0,T=1,N=2,L=3,R=4,O=5,$=6,D=7,S=8,B=9,P=12;function M(e){let t=0;const n={};for(;e.offset<e.view.byteLength;){const[r,i,o]=C(e,t);if(t=o,r===b)break;n[`field_${i}`]=U(e,r)}return n}function U(e,t){switch(t){case T:return!0;case N:return!1;case L:return e.view.getInt8(e.offset++);case R:case O:return Y(e);case $:return F(e);case D:{const t=e.view.getFloat64(e.offset,!0);return e.offset+=8,t}case S:{const t=q(e),n=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=t,n}case B:{const t=e.view.getUint8(e.offset++),n=15&t;let r=t>>4;15===r&&(r=q(e));const i=n===T||n===N,o=new Array(r);for(let t=0;t<r;t++)o[t]=i?1===U(e,L):U(e,n);return o}case P:{const t={};let n=0;for(;;){const[r,i,o]=C(e,n);if(n=o,r===b)break;t[`field_${i}`]=U(e,r)}return t}default:throw new Error(`thrift unhandled type: ${t}`)}}function q(e){let t=0,n=0;for(;;){const r=e.view.getUint8(e.offset++);if(t|=(127&r)<<n,!(128&r))return t;n+=7}}function Y(e){const t=q(e);return t>>>1^-(1&t)}function F(e){const t=function(e){let t=0n,n=0n;for(;;){const r=e.view.getUint8(e.offset++);if(t|=BigInt(127&r)<<n,!(128&r))return t;n+=7n}}(e);return t>>1n^-(1n&t)}function C(e,t){const n=e.view.getUint8(e.offset++),r=15&n;if(r===b)return[0,0,t];const i=n>>4,o=i?t+i:Y(e);return[r,o,o]}const x=new TextDecoder;function G(e){return e&&x.decode(e)}async function k(e,{parsers:t,initialFetchSize:n=524288,geoparquet:r=!0}={}){if(!(e&&e.byteLength>=0))throw new Error("parquet expected AsyncBuffer");const i=Math.max(0,e.byteLength-n),o=await e.slice(i,e.byteLength),f=new DataView(o);if(827474256!==f.getUint32(o.byteLength-4,!0))throw new Error("parquet file invalid (footer != PAR1)");const s=f.getUint32(o.byteLength-8,!0);if(s>e.byteLength-8)throw new Error(`parquet metadata length ${s} exceeds available buffer ${e.byteLength-8}`);if(s+8>n){const n=e.byteLength-s-8,f=await e.slice(n,i),a=new ArrayBuffer(s+8),l=new Uint8Array(a);return l.set(new Uint8Array(f)),l.set(new Uint8Array(o),i-n),j(a,{parsers:t,geoparquet:r})}return j(o,{parsers:t,geoparquet:r})}function j(f,{parsers:s,geoparquet:a=!0}={}){if(!(f instanceof ArrayBuffer))throw new Error("parquet expected ArrayBuffer");const l=new DataView(f);if(s={...p,...s},l.byteLength<8)throw new Error("parquet file is too short");if(827474256!==l.getUint32(l.byteLength-4,!0))throw new Error("parquet file invalid (footer != PAR1)");const c=l.byteLength-8,u=l.getUint32(c,!0);if(u>l.byteLength-8)throw new Error(`parquet metadata length ${u} exceeds available buffer ${l.byteLength-8}`);const d=M({view:l,offset:c-u}),_=d.field_1,h=d.field_2.map((t=>({type:e[t.field_1],type_length:t.field_2,repetition_type:n[t.field_3],name:G(t.field_4),num_children:t.field_5,converted_type:r[t.field_6],scale:t.field_7,precision:t.field_8,field_id:t.field_9,logical_type:V(t.field_10)}))),y=h.filter((e=>e.type)),m=d.field_3,g=d.field_4.map((n=>({columns:n.field_1.map(((n,r)=>({file_path:G(n.field_1),file_offset:n.field_2,meta_data:n.field_3&&{type:e[n.field_3.field_1],encodings:n.field_3.field_2?.map((e=>t[e])),path_in_schema:n.field_3.field_3.map(G),codec:i[n.field_3.field_4],num_values:n.field_3.field_5,total_uncompressed_size:n.field_3.field_6,total_compressed_size:n.field_3.field_7,key_value_metadata:n.field_3.field_8?.map((e=>({key:G(e.field_1),value:G(e.field_2)}))),data_page_offset:n.field_3.field_9,index_page_offset:n.field_3.field_10,dictionary_page_offset:n.field_3.field_11,statistics:Q(n.field_3.field_12,y[r],s),encoding_stats:n.field_3.field_13?.map((e=>({page_type:o[e.field_1],encoding:t[e.field_2],count:e.field_3}))),bloom_filter_offset:n.field_3.field_14,bloom_filter_length:n.field_3.field_15,size_statistics:n.field_3.field_16&&{unencoded_byte_array_data_bytes:n.field_3.field_16.field_1,repetition_level_histogram:n.field_3.field_16.field_2,definition_level_histogram:n.field_3.field_16.field_3},geospatial_statistics:n.field_3.field_17&&{bbox:n.field_3.field_17.field_1&&{xmin:n.field_3.field_17.field_1.field_1,xmax:n.field_3.field_17.field_1.field_2,ymin:n.field_3.field_17.field_1.field_3,ymax:n.field_3.field_17.field_1.field_4,zmin:n.field_3.field_17.field_1.field_5,zmax:n.field_3.field_17.field_1.field_6,mmin:n.field_3.field_17.field_1.field_7,mmax:n.field_3.field_17.field_1.field_8},geospatial_types:n.field_3.field_17.field_2}},offset_index_offset:n.field_4,offset_index_length:n.field_5,column_index_offset:n.field_6,column_index_length:n.field_7,crypto_metadata:n.field_8,encrypted_column_metadata:n.field_9}))),total_byte_size:n.field_2,num_rows:n.field_3,sorting_columns:n.field_4?.map((e=>({column_idx:e.field_1,descending:e.field_2,nulls_first:e.field_3}))),file_offset:n.field_5,total_compressed_size:n.field_6,ordinal:n.field_7}))),w=d.field_5?.map((e=>({key:G(e.field_1),value:G(e.field_2)}))),A=G(d.field_6);return a&&function(e,t){const n=new Map,r=t?.find((({key:e})=>"geo"===e))?.value,i=(r&&JSON.parse(r)?.columns)??{};for(const[e,t]of Object.entries(i)){if("WKB"!==t.encoding)continue;const r="spherical"===t.edges?"GEOGRAPHY":"GEOMETRY",i=t.crs?.id??t.crs?.ids?.[0],o=i?`${i.authority}:${i.code.toString()}`:void 0;n.set(e,{type:r,crs:o})}for(let t=1;t<e.length;t++){const r=e[t],{logical_type:i,name:o,num_children:f,repetition_type:s,type:a}=r;f?t+=f:"BYTE_ARRAY"===a&&void 0===i&&"REPEATED"!==s&&(r.logical_type=n.get(o))}}(h,w),{version:_,schema:h,num_rows:m,row_groups:g,key_value_metadata:w,created_by:A,metadata_length:u}}function z({schema:e}){return A(e,[])[0]}function V(e){return e?.field_1?{type:"STRING"}:e?.field_2?{type:"MAP"}:e?.field_3?{type:"LIST"}:e?.field_4?{type:"ENUM"}:e?.field_5?{type:"DECIMAL",scale:e.field_5.field_1,precision:e.field_5.field_2}:e?.field_6?{type:"DATE"}:e?.field_7?{type:"TIME",isAdjustedToUTC:e.field_7.field_1,unit:H(e.field_7.field_2)}:e?.field_8?{type:"TIMESTAMP",isAdjustedToUTC:e.field_8.field_1,unit:H(e.field_8.field_2)}:e?.field_10?{type:"INTEGER",bitWidth:e.field_10.field_1,isSigned:e.field_10.field_2}:e?.field_11?{type:"NULL"}:e?.field_12?{type:"JSON"}:e?.field_13?{type:"BSON"}:e?.field_14?{type:"UUID"}:e?.field_15?{type:"FLOAT16"}:e?.field_16?{type:"VARIANT",specification_version:e.field_16.field_1}:e?.field_17?{type:"GEOMETRY",crs:G(e.field_17.field_1)}:e?.field_18?{type:"GEOGRAPHY",crs:G(e.field_18.field_1),algorithm:s[e.field_18.field_2]}:e}function H(e){if(e.field_1)return"MILLIS";if(e.field_2)return"MICROS";if(e.field_3)return"NANOS";throw new Error("parquet time unit required")}function Q(e,t,n){return e&&{max:K(e.field_1,t,n),min:K(e.field_2,t,n),null_count:e.field_3,distinct_count:e.field_4,max_value:K(e.field_5,t,n),min_value:K(e.field_6,t,n),is_max_value_exact:e.field_7,is_min_value_exact:e.field_8}}function K(e,t,n){const{type:r,converted_type:i,logical_type:o}=t;if(void 0===e)return e;if("BOOLEAN"===r)return 1===e[0];if("BYTE_ARRAY"===r)return n.stringFromBytes(e);const f=new DataView(e.buffer,e.byteOffset,e.byteLength);return"FLOAT"===r&&4===f.byteLength?f.getFloat32(0,!0):"DOUBLE"===r&&8===f.byteLength?f.getFloat64(0,!0):"INT32"===r&&"DATE"===i?n.dateFromDays(f.getInt32(0,!0)):"INT64"===r&&"TIMESTAMP_MILLIS"===i?n.timestampFromMilliseconds(f.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP_MICROS"===i?n.timestampFromMicroseconds(f.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP"===o?.type&&"NANOS"===o?.unit?n.timestampFromNanoseconds(f.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP"===o?.type&&"MICROS"===o?.unit?n.timestampFromMicroseconds(f.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP"===o?.type?n.timestampFromMilliseconds(f.getBigInt64(0,!0)):"INT32"===r&&4===f.byteLength?f.getInt32(0,!0):"INT64"===r&&8===f.byteLength?f.getBigInt64(0,!0):"DECIMAL"===i?m(e)*10**-(t.scale||0):"FLOAT16"===o?.type?g(e):e}function W(e,t,n=void 0){n={...p,...n};const r=M(e);return{null_pages:r.field_1,min_values:r.field_2.map((e=>K(e,t,n))),max_values:r.field_3.map((e=>K(e,t,n))),boundary_order:f[r.field_4],null_counts:r.field_5,repetition_level_histograms:r.field_6,definition_level_histograms:r.field_7}}function J(e){const t=M(e);return{page_locations:t.field_1.map(X),unencoded_byte_array_data_bytes:t.field_2}}function X(e){return{offset:e.field_1,compressed_page_size:e.field_2,first_row_index:e.field_3}}function Z(e){if(void 0===e)return null;if("bigint"==typeof e)return Number(e);if(Array.isArray(e))return e.map(Z);if(e instanceof Uint8Array)return Array.from(e);if(e instanceof Date)return e.toISOString();if(e instanceof Object){const t={};for(const n of Object.keys(e))void 0!==e[n]&&(t[n]=Z(e[n]));return t}return e}function ee(e,t){for(let n=0;n<t.length;n+=1e4)e.push(...t.slice(n,n+1e4))}function te(e,t){return e===t||(e instanceof Uint8Array&&t instanceof Uint8Array?te(Array.from(e),Array.from(t)):!(!e||!t||typeof e!=typeof t)&&(Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every(((e,n)=>te(e,t[n]))):"object"==typeof e&&Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((n=>te(e[n],t[n])))))}async function ne(e,t={},n=globalThis.fetch){const r=new AbortController,i=new Headers(t.headers);i.set("Range","bytes=0-0");const o=await n(e,{...t,headers:i,signal:r.signal});if(!o.ok)throw new Error(`fetch with range failed ${o.status}`);if(206===o.status){const e=o.headers.get("Content-Range");if(!e)throw new Error("missing content-range header");const t=e.match(/bytes \d+-\d+\/(\d+)/);if(!t)throw new Error(`invalid content-range header: ${e}`);return parseInt(t[1])}if(200===o.status){const e=o.headers.get("Content-Length");if(r.abort(),e)return parseInt(e)}throw new Error("server does not support range requests and missing content-length")}async function re(e,t,n){const r=n??globalThis.fetch,i=await r(e,{...t,method:"HEAD"});if(403===i.status)return ne(e,t,r);if(!i.ok)throw new Error(`fetch head failed ${i.status}`);const o=i.headers.get("Content-Length");return o?parseInt(o):ne(e,t,r)}async function ie({url:e,byteLength:t,requestInit:n,fetch:r}){if(!e)throw new Error("missing url");const i=r??globalThis.fetch;let o;t??=await re(e,n,i);const f=n||{};return{byteLength:t,async slice(t,n){if(o)return o.then((e=>e.slice(t,n)));const r=new Headers(f.headers),s=void 0===n?"":n-1;r.set("Range",`bytes=${t}-${s}`);const a=await i(e,{...f,headers:r});if(!a.ok||!a.body)throw new Error(`fetch failed ${a.status}`);if(200===a.status)return o=a.arrayBuffer(),o.then((e=>e.slice(t,n)));if(206===a.status)return a.arrayBuffer();throw new Error(`fetch received unexpected status code ${a.status}`)}}}function oe({byteLength:e,slice:t},{minSize:n=524288}={}){if(e<n){const n=t(0,e);return{byteLength:e,slice:async(e,t)=>(await n).slice(e,t)}}const r=new Map;return{byteLength:e,slice(n,i){const o=function(e,t,n){if(e<0){if(void 0!==t)throw new Error(`invalid suffix range [${e}, ${t}]`);return void 0===n?`${e},`:`${n+e},${n}`}if(void 0!==t){if(e>t)throw new Error(`invalid empty range [${e}, ${t}]`);return`${e},${t}`}return void 0===n?`${e},`:`${e},${n}`}(n,i,e),f=r.get(o);if(f)return f;const s=t(n,i);return r.set(o,s),s}}}function fe(e){if(!e)return[];if(1===e.length)return e[0];const t=[];for(const n of e)ee(t,n);return t}function se(e,t={}){return"$and"in t&&Array.isArray(t.$and)?t.$and.every((t=>se(e,t))):"$or"in t&&Array.isArray(t.$or)?t.$or.some((t=>se(e,t))):"$nor"in t&&Array.isArray(t.$nor)?!t.$nor.some((t=>se(e,t))):Object.entries(t).every((([t,n])=>{const r=e[t];return"object"!=typeof n||null===n||Array.isArray(n)?te(r,n):Object.entries(n||{}).every((([e,n])=>"$gt"===e?r>n:"$gte"===e?r>=n:"$lt"===e?r<n:"$lte"===e?r<=n:"$eq"===e?te(r,n):"$ne"===e?!te(r,n):"$in"===e?Array.isArray(n)&&n.includes(r):"$nin"===e?Array.isArray(n)&&!n.includes(r):"$not"!==e||!se({[t]:r},{[t]:n})))}))}function ae(e,t,n){if(!e)return!1;if("$and"in e&&Array.isArray(e.$and))return e.$and.some((e=>ae(e,t,n)));if("$or"in e&&Array.isArray(e.$or))return e.$or.every((e=>ae(e,t,n)));if("$nor"in e&&Array.isArray(e.$nor))return!1;for(const[r,i]of Object.entries(e)){const e=n.indexOf(r);if(-1===e)continue;const o=t.columns[e],f=o.meta_data?.statistics;if(!f)continue;const{min:s,max:a,min_value:l,max_value:c}=f,u=void 0!==l?l:s,d=void 0!==c?c:a;if(void 0!==u&&void 0!==d)for(const[e,t]of Object.entries(i||{})){if("$gt"===e&&d<=t)return!0;if("$gte"===e&&d<t)return!0;if("$lt"===e&&u>=t)return!0;if("$lte"===e&&u>t)return!0;if("$eq"===e&&(t<u||t>d))return!0;if("$ne"===e&&te(u,d)&&te(u,t))return!0;if("$in"===e&&Array.isArray(t)&&t.every((e=>e<u||e>d)))return!0;if("$nin"===e&&Array.isArray(t)&&te(u,d)&&t.includes(u))return!0}}return!1}function le({dictionary_page_offset:e,data_page_offset:t,total_compressed_size:n}){const r=e||t;return{startByte:Number(r),endByte:Number(r+n)}}function ce(e,t,n,r,i){const o=t?.length||n.length;if(!o)return r;const f=v(i),s=i.map((({element:e})=>e.repetition_type));let a=0;const l=[e];let c=e,u=0,d=0,_=0;if(n[0])for(;u<s.length-2&&_<n[0];)u++,"REQUIRED"!==s[u]&&(c=c.at(-1),l.push(c),d++),"REPEATED"===s[u]&&_++;for(let e=0;e<o;e++){const i=t?.length?t[e]:f,o=n[e];for(;u&&(o<_||"REPEATED"!==s[u]);)"REQUIRED"!==s[u]&&(l.pop(),d--),"REPEATED"===s[u]&&_--,u--;for(c=l.at(-1);(u<s.length-2||"REPEATED"===s[u+1])&&(d<i||"REQUIRED"===s[u+1]);){if(u++,"REQUIRED"!==s[u]){const e=[];c.push(e),c=e,l.push(e),d++}"REPEATED"===s[u]&&_++}i===f?c.push(r[a++]):u===s.length-2?c.push(null):c.push([])}if(!e.length)for(let e=0;e<f;e++){const e=[];c.push(e),c=e}return e}function ue(e,t,n=0){const r=t.path.join("."),i="OPTIONAL"===t.element.repetition_type,o=i?n+1:n;if(function(e){if(!e)return!1;if("LIST"!==e.element.converted_type)return!1;if(e.children.length>1)return!1;const t=e.children[0];return!(t.children.length>1)&&"REPEATED"===t.element.repetition_type}(t)){let f=t.children[0],s=o;1===f.children.length&&(f=f.children[0],s++),ue(e,f,s);const a=f.path.join("."),l=e.get(a);if(!l)throw new Error("parquet list column missing values");return i&&de(l,n),e.set(r,l),void e.delete(a)}if(function(e){if(!e)return!1;if("MAP"!==e.element.converted_type)return!1;if(e.children.length>1)return!1;const t=e.children[0];if(2!==t.children.length)return!1;if("REPEATED"!==t.element.repetition_type)return!1;const n=t.children.find((e=>"key"===e.element.name));if("REPEATED"===n?.element.repetition_type)return!1;const r=t.children.find((e=>"value"===e.element.name));return"REPEATED"!==r?.element.repetition_type}(t)){const f=t.children[0].element.name;ue(e,t.children[0].children[0],o+1),ue(e,t.children[0].children[1],o+1);const s=e.get(`${r}.${f}.key`),a=e.get(`${r}.${f}.value`);if(!s)throw new Error("parquet map column missing keys");if(!a)throw new Error("parquet map column missing values");if(s.length!==a.length)throw new Error("parquet map column key/value length mismatch");const l=_e(s,a,o);return i&&de(l,n),e.delete(`${r}.${f}.key`),e.delete(`${r}.${f}.value`),void e.set(r,l)}if(t.children.length){const o="REQUIRED"===t.element.repetition_type?n:n+1,f={};for(const n of t.children){ue(e,n,o);const t=e.get(n.path.join("."));if(!t)throw new Error("parquet struct missing child data");f[n.element.name]=t}for(const n of t.children)e.delete(n.path.join("."));const s=pe(f,o);i&&de(s,n),e.set(r,s)}}function de(e,t){for(let n=0;n<e.length;n++)t?de(e[n],t-1):e[n]=e[n][0]}function _e(e,t,n){const r=[];for(let i=0;i<e.length;i++)if(n)r.push(_e(e[i],t[i],n-1));else if(e[i]){const n={};for(let r=0;r<e[i].length;r++){const o=t[i][r];n[e[i][r]]=void 0===o?null:o}r.push(n)}else r.push(void 0);return r}function pe(e,t){const n=Object.keys(e),r=e[n[0]]?.length,i=[];for(let o=0;o<r;o++){const f={};for(const t of n){if(e[t].length!==r)throw new Error("parquet struct parsing error");f[t]=e[t][o]}t?i.push(pe(f,t-1)):i.push(f)}return i}function he(e,t,n){const r=n instanceof Int32Array,i=q(e),o=q(e);q(e);let f=F(e),s=0;n[s++]=r?Number(f):f;const a=i/o;for(;s<t;){const i=F(e),l=new Uint8Array(o);for(let t=0;t<o;t++)l[t]=e.view.getUint8(e.offset++);for(let c=0;c<o&&s<t;c++){const o=BigInt(l[c]);if(o){let l=0n,c=a;const u=(1n<<o)-1n;for(;c&&s<t;){let t=BigInt(e.view.getUint8(e.offset))>>l&u;for(l+=o;l>=8;)l-=8n,e.offset++,l&&(t|=BigInt(e.view.getUint8(e.offset))<<o-l&u);f+=i+t,n[s++]=r?Number(f):f,c--}c&&(e.offset+=Math.ceil((c*Number(o)+Number(l))/8))}else for(let e=0;e<a&&s<t;e++)f+=i,n[s++]=r?Number(f):f}}}function ye(e,t,n){const r=new Int32Array(t);he(e,t,r);for(let i=0;i<t;i++)n[i]=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,r[i]),e.offset+=r[i]}function me(e){return 32-Math.clz32(e)}function ge(e,t,n,r){void 0===r&&(r=e.view.getUint32(e.offset,!0),e.offset+=4);const i=e.offset;let o=0;for(;o<n.length;){const r=q(e);if(1&r)o=Ae(e,r,t,n,o);else{const i=r>>>1;we(e,i,t,n,o),o+=i}}e.offset=i+r}function we(e,t,n,r,i){const o=n+7>>3;let f=0;for(let t=0;t<o;t++)f|=e.view.getUint8(e.offset++)<<(t<<3);for(let e=0;e<t;e++)r[i+e]=f}function Ae(e,t,n,r,i){let o=t>>1<<3;const f=(1<<n)-1;let s=0;if(e.offset<e.view.byteLength)s=e.view.getUint8(e.offset++);else if(f)throw new Error(`parquet bitpack offset ${e.offset} out of range`);let a=8,l=0;for(;o;)l>8?(l-=8,a-=8,s>>>=8):a-l<n?(s|=e.view.getUint8(e.offset)<<a,e.offset++,a+=8):(i<r.length&&(r[i++]=s>>l&f),o--,l+=n);return i}function Ee(e,t,n,r){const i=function(e,t){switch(e){case"INT32":case"FLOAT":return 4;case"INT64":case"DOUBLE":return 8;case"FIXED_LEN_BYTE_ARRAY":if(!t)throw new Error("parquet byteWidth missing type_length");return t;default:throw new Error(`parquet unsupported type: ${e}`)}}(n,r),o=new Uint8Array(t*i);for(let n=0;n<i;n++)for(let r=0;r<t;r++)o[r*i+n]=e.view.getUint8(e.offset++);if("FLOAT"===n)return new Float32Array(o.buffer);if("DOUBLE"===n)return new Float64Array(o.buffer);if("INT32"===n)return new Int32Array(o.buffer);if("INT64"===n)return new BigInt64Array(o.buffer);if("FIXED_LEN_BYTE_ARRAY"===n){const e=new Array(t);for(let n=0;n<t;n++)e[n]=o.subarray(n*i,(n+1)*i);return e}throw new Error(`parquet byte_stream_split unsupported type: ${n}`)}function ve(e,t,n,r){if(0===n)return[];if("BOOLEAN"===t)return function(e,t){const n=new Array(t);for(let r=0;r<t;r++){const t=e.offset+(r/8|0),i=r%8,o=e.view.getUint8(t);n[r]=!!(o&1<<i)}return e.offset+=Math.ceil(t/8),n}(e,n);if("INT32"===t)return function(e,t){const n=(e.view.byteOffset+e.offset)%4?new Int32Array(Ie(e.view.buffer,e.view.byteOffset+e.offset,4*t)):new Int32Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=4*t,n}(e,n);if("INT64"===t)return function(e,t){const n=(e.view.byteOffset+e.offset)%8?new BigInt64Array(Ie(e.view.buffer,e.view.byteOffset+e.offset,8*t)):new BigInt64Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=8*t,n}(e,n);if("INT96"===t)return function(e,t){const n=new Array(t);for(let r=0;r<t;r++){const t=e.view.getBigInt64(e.offset+12*r,!0),i=e.view.getInt32(e.offset+12*r+8,!0);n[r]=BigInt(i)<<64n|t}return e.offset+=12*t,n}(e,n);if("FLOAT"===t)return function(e,t){const n=(e.view.byteOffset+e.offset)%4?new Float32Array(Ie(e.view.buffer,e.view.byteOffset+e.offset,4*t)):new Float32Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=4*t,n}(e,n);if("DOUBLE"===t)return function(e,t){const n=(e.view.byteOffset+e.offset)%8?new Float64Array(Ie(e.view.buffer,e.view.byteOffset+e.offset,8*t)):new Float64Array(e.view.buffer,e.view.byteOffset+e.offset,t);return e.offset+=8*t,n}(e,n);if("BYTE_ARRAY"===t)return function(e,t){const n=new Array(t);for(let r=0;r<t;r++){const t=e.view.getUint32(e.offset,!0);e.offset+=4,n[r]=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,t),e.offset+=t}return n}(e,n);if("FIXED_LEN_BYTE_ARRAY"===t){if(!r)throw new Error("parquet missing fixed length");return function(e,t,n){const r=new Array(t);for(let i=0;i<t;i++)r[i]=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,n),e.offset+=n;return r}(e,n,r)}throw new Error(`parquet unhandled type: ${t}`)}function Ie(e,t,n){const r=new ArrayBuffer(n);return new Uint8Array(r).set(new Uint8Array(e,t,n)),r}const be=[0,255,65535,16777215,4294967295];function Te(e,t,n,r,i){for(let o=0;o<i;o++)n[r+o]=e[t+o]}function Ne(e,t){const n=e.byteLength,r=t.byteLength;let i=0,o=0;for(;i<n;){const t=e[i];if(i++,t<128)break}if(r&&i>=n)throw new Error("invalid snappy length header");for(;i<n;){const r=e[i];let f=0;if(i++,i>=n)throw new Error("missing eof marker");if(3&r){let s=0;switch(3&r){case 1:f=4+(r>>>2&7),s=e[i]+(r>>>5<<8),i++;break;case 2:if(n<=i+1)throw new Error("snappy error end of input");f=1+(r>>>2),s=e[i]+(e[i+1]<<8),i+=2;break;case 3:if(n<=i+3)throw new Error("snappy error end of input");f=1+(r>>>2),s=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+(e[i+3]<<24),i+=4}if(0===s||isNaN(s))throw new Error(`invalid offset ${s} pos ${i} inputLength ${n}`);if(s>o)throw new Error("cannot copy from before start of buffer");Te(t,o-s,t,o,f),o+=f}else{let f=1+(r>>>2);if(f>60){if(i+3>=n)throw new Error("snappy error literal pos + 3 >= inputLength");const t=f-60;f=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+(e[i+3]<<24),f=1+(f&be[t]),i+=t}if(i+f>n)throw new Error("snappy error literal exceeds input length");Te(e,i,t,o,f),i+=f,o+=f}}if(o!==r)throw new Error("premature end of input")}function Le(e,t,{type:n,element:r,schemaPath:i}){const o=new DataView(e.buffer,e.byteOffset,e.byteLength),f={view:o,offset:0};let s;const a=function(e,t,n){if(n.length>1){const r=E(n);if(r){const n=new Array(t.num_values);return ge(e,me(r),n),n}}return[]}(f,t,i),{definitionLevels:l,numNulls:c}=function(e,t,n){const r=v(n);if(!r)return{definitionLevels:[],numNulls:0};const i=new Array(t.num_values);ge(e,me(r),i);let o=t.num_values;for(const e of i)e===r&&o--;0===o&&(i.length=0);return{definitionLevels:i,numNulls:o}}(f,t,i),u=t.num_values-c;if("PLAIN"===t.encoding)s=ve(f,n,u,r.type_length);else if("PLAIN_DICTIONARY"===t.encoding||"RLE_DICTIONARY"===t.encoding||"RLE"===t.encoding){const e="BOOLEAN"===n?1:o.getUint8(f.offset++);e?(s=new Array(u),"BOOLEAN"===n?(ge(f,e,s),s=s.map((e=>!!e))):ge(f,e,s,o.byteLength-f.offset)):s=new Uint8Array(u)}else if("BYTE_STREAM_SPLIT"===t.encoding)s=Ee(f,u,n,r.type_length);else if("DELTA_BINARY_PACKED"===t.encoding){s="INT32"===n?new Int32Array(u):new BigInt64Array(u),he(f,u,s)}else{if("DELTA_LENGTH_BYTE_ARRAY"!==t.encoding)throw new Error(`parquet unsupported encoding: ${t.encoding}`);s=new Array(u),ye(f,u,s)}return{definitionLevels:l,repetitionLevels:a,dataPage:s}}function Re(e,t,n,r){let i;const o=r?.[n];if("UNCOMPRESSED"===n)i=e;else if(o)i=o(e,t);else{if("SNAPPY"!==n)throw new Error(`parquet unsupported compression codec: ${n}`);i=new Uint8Array(t),Ne(e,i)}if(i?.length!==t)throw new Error(`parquet decompressed page length ${i?.length} does not match header ${t}`);return i}function Oe(e,t,n){const r={view:new DataView(e.buffer,e.byteOffset,e.byteLength),offset:0},{type:i,element:o,schemaPath:f,codec:s,compressors:a}=n,l=t.data_page_header_v2;if(!l)throw new Error("parquet data page header v2 is undefined");const c=function(e,t,n){const r=E(n);if(!r)return[];const i=new Array(t.num_values);return ge(e,me(r),i,t.repetition_levels_byte_length),i}(r,l,f);r.offset=l.repetition_levels_byte_length;const u=function(e,t,n){const r=v(n);if(r){const n=new Array(t.num_values);return ge(e,me(r),n,t.definition_levels_byte_length),n}}(r,l,f),d=t.uncompressed_page_size-l.definition_levels_byte_length-l.repetition_levels_byte_length;let _=e.subarray(r.offset);!1!==l.is_compressed&&(_=Re(_,d,s,a));const p=new DataView(_.buffer,_.byteOffset,_.byteLength),h={view:p,offset:0};let y;const m=l.num_values-l.num_nulls;if("PLAIN"===l.encoding)y=ve(h,i,m,o.type_length);else if("RLE"===l.encoding)y=new Array(m),ge(h,1,y),y=y.map((e=>!!e));else if("PLAIN_DICTIONARY"===l.encoding||"RLE_DICTIONARY"===l.encoding){const e=p.getUint8(h.offset++);y=new Array(m),ge(h,e,y,d-1)}else if("DELTA_BINARY_PACKED"===l.encoding){y="INT32"===i?new Int32Array(m):new BigInt64Array(m),he(h,m,y)}else if("DELTA_LENGTH_BYTE_ARRAY"===l.encoding)y=new Array(m),ye(h,m,y);else if("DELTA_BYTE_ARRAY"===l.encoding)y=new Array(m),function(e,t,n){const r=new Int32Array(t);he(e,t,r);const i=new Int32Array(t);he(e,t,i);for(let o=0;o<t;o++){const t=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,i[o]);r[o]?(n[o]=new Uint8Array(r[o]+i[o]),n[o].set(n[o-1].subarray(0,r[o])),n[o].set(t,r[o])):n[o]=t,e.offset+=i[o]}}(h,m,y);else{if("BYTE_STREAM_SPLIT"!==l.encoding)throw new Error(`parquet unsupported encoding: ${l.encoding}`);y=Ee(h,m,i,o.type_length)}return{definitionLevels:u,repetitionLevels:c,dataPage:y}}function $e(e,{groupStart:t,selectStart:n,selectEnd:r},i,o){const{pathInSchema:f,schemaPath:s}=i,a=I(s),l=[];let c,u,d=0;const _=o&&(()=>{u&&o({pathInSchema:f,columnData:u,rowStart:t+d-u.length,rowEnd:t+d})});for(;(a?d<r:e.offset<e.view.byteLength-1)&&!(e.offset>=e.view.byteLength-1);){const t=Se(e);if("DICTIONARY_PAGE"===t.type)c=De(e,t,i,c,void 0,0),c=y(c,i);else{const r=u?.length||0,o=De(e,t,i,c,u,n-d);u===o?d+=o.length-r:(_?.(),l.push(o),d+=o.length,u=o)}}return _?.(),d>r&&u&&(l[l.length-1]=u.slice(0,r-(d-u.length))),l}function De(e,t,n,r,i,o){const{type:f,element:s,schemaPath:a,codec:l,compressors:c}=n,u=new Uint8Array(e.view.buffer,e.view.byteOffset+e.offset,t.compressed_page_size);if(e.offset+=t.compressed_page_size,"DATA_PAGE"===t.type){const e=t.data_page_header;if(!e)throw new Error("parquet data page header is undefined");if(o>e.num_values&&I(a))return new Array(e.num_values);const f=Re(u,Number(t.uncompressed_page_size),l,c),{definitionLevels:s,repetitionLevels:d,dataPage:_}=Le(f,e,n);let p=h(_,r,e.encoding,n);if(d.length||s?.length){return ce(Array.isArray(i)?i:[],s,d,p,a)}for(let e=2;e<a.length;e++)"REQUIRED"!==a[e].element.repetition_type&&(p=Array.from(p,(e=>[e])));return p}if("DATA_PAGE_V2"===t.type){const e=t.data_page_header_v2;if(!e)throw new Error("parquet data page header v2 is undefined");if(o>e.num_rows)return new Array(e.num_values);const{definitionLevels:f,repetitionLevels:s,dataPage:l}=Oe(u,t,n),c=h(l,r,e.encoding,n);return ce(Array.isArray(i)?i:[],f,s,c,a)}if("DICTIONARY_PAGE"===t.type){const e=t.dictionary_page_header;if(!e)throw new Error("parquet dictionary page header is undefined");const n=Re(u,Number(t.uncompressed_page_size),l,c);return ve({view:new DataView(n.buffer,n.byteOffset,n.byteLength),offset:0},f,e.num_values,s.type_length)}throw new Error(`parquet unsupported page type: ${t.type}`)}function Se(e){const n=M(e);return{type:o[n.field_1],uncompressed_page_size:n.field_2,compressed_page_size:n.field_3,crc:n.field_4,data_page_header:n.field_5&&{num_values:n.field_5.field_1,encoding:t[n.field_5.field_2],definition_level_encoding:t[n.field_5.field_3],repetition_level_encoding:t[n.field_5.field_4],statistics:n.field_5.field_5&&{max:n.field_5.field_5.field_1,min:n.field_5.field_5.field_2,null_count:n.field_5.field_5.field_3,distinct_count:n.field_5.field_5.field_4,max_value:n.field_5.field_5.field_5,min_value:n.field_5.field_5.field_6}},index_page_header:n.field_6,dictionary_page_header:n.field_7&&{num_values:n.field_7.field_1,encoding:t[n.field_7.field_2],is_sorted:n.field_7.field_3},data_page_header_v2:n.field_8&&{num_values:n.field_8.field_1,num_nulls:n.field_8.field_2,num_rows:n.field_8.field_3,encoding:t[n.field_8.field_4],definition_levels_byte_length:n.field_8.field_5,repetition_levels_byte_length:n.field_8.field_6,is_compressed:void 0===n.field_8.field_7||n.field_8.field_7,statistics:n.field_8.field_8}}}async function Be({asyncColumns:e},t,n,r,i){const o=await Promise.all(e.map((({data:e})=>e.then(fe)))),f=e.map((e=>e.pathInSchema[0])).filter((e=>!r||r.includes(e))),s=r??f,a=s.map((t=>e.findIndex((e=>e.pathInSchema[0]===t)))),l=n-t;if("object"===i){const n=new Array(l);for(let r=0;r<l;r++){const i=t+r,f={};for(let t=0;t<e.length;t++)f[e[t].pathInSchema[0]]=o[t][i];n[r]=f}return n}const c=new Array(l);for(let n=0;n<l;n++){const r=t+n,i=new Array(e.length);for(let e=0;e<s.length;e++)a[e]>=0&&(i[e]=o[a[e]][r]);c[n]=i}return c}function Pe(e,t){const{asyncColumns:n}=e,r=[];for(const e of t.children)if(e.children.length){const t=n.filter((t=>t.pathInSchema[0]===e.element.name));if(!t.length)continue;const i=new Map,o=Promise.all(t.map((e=>e.data.then((t=>{i.set(e.pathInSchema.join("."),fe(t))}))))).then((()=>{ue(i,e);const t=i.get(e.path.join("."));if(!t)throw new Error("parquet column data not assembled");return[t]}));r.push({pathInSchema:e.path,data:o})}else{const t=n.find((t=>t.pathInSchema[0]===e.element.name));t&&r.push(t)}return{...e,asyncColumns:r}}async function Me(e){e.metadata??=await k(e.file,e);const t=Ue(e),{rowStart:n=0,rowEnd:r,columns:i,onChunk:o,onComplete:f,rowFormat:s}=e;if(!f&&!o){for(const{asyncColumns:e}of t)for(const{data:t}of e)await t;return}const a=z(e.metadata),l=t.map((e=>Pe(e,a)));if(o)for(const e of l)for(const t of e.asyncColumns)t.data.then((n=>{let r=e.groupStart;for(const e of n)o({columnName:t.pathInSchema[0],columnData:e,rowStart:r,rowEnd:r+e.length}),r+=e.length}));if(f){const e=[];for(const t of l){const o=Math.max(n-t.groupStart,0),f=Math.min((r??1/0)-t.groupStart,t.groupRows);ee(e,"object"===s?await Be(t,o,f,i,"object"):await Be(t,o,f,i,"array"))}f(e)}else for(const{asyncColumns:e}of l)for(const{data:t}of e)await t}function Ue(e){if(!e.metadata)throw new Error("parquet requires metadata");const t=function({metadata:e,rowStart:t=0,rowEnd:n=1/0,columns:r,filter:i}){if(!e)throw new Error("parquetPlan requires metadata");const o=[],f=[],s=function(e){const t=[];return function e(n){if(n.children.length)for(const t of n.children)e(t);else t.push(n.element.name)}(e),t}(z(e));let a=0;for(const l of e.row_groups){const e=Number(l.num_rows),c=a+e;if(e>0&&c>t&&a<n&&!ae(i,l,s)){const i=[];for(const{file_path:e,meta_data:t}of l.columns){if(e)throw new Error("parquet file_path not supported");if(!t)throw new Error("parquet column metadata is undefined");r&&!r.includes(t.path_in_schema[0])||i.push(le(t))}const s=Math.max(t-a,0),c=Math.min(n-a,e);o.push({ranges:i,rowGroup:l,groupStart:a,groupRows:e,selectStart:s,selectEnd:c});const u=i[i.length-1]?.endByte-i[0]?.startByte;if(!r&&u<33554432)f.push({startByte:i[0].startByte,endByte:i[i.length-1].endByte});else if(i.length)ee(f,i);else if(r?.length)throw new Error(`parquet columns not found: ${r.join(", ")}`)}a=c}return isFinite(n)||(n=a),{metadata:e,rowStart:t,rowEnd:n,columns:r,fetches:f,groups:o}}(e);return e.file=function(e,{fetches:t}){const n=t.map((({startByte:t,endByte:n})=>e.slice(t,n)));return{byteLength:e.byteLength,slice(r,i=e.byteLength){const o=t.findIndex((({startByte:e,endByte:t})=>e<=r&&i<=t));if(o<0)throw new Error(`no prefetch for range [${r}, ${i}]`);if(t[o].startByte!==r||t[o].endByte!==i){const e=r-t[o].startByte,f=i-t[o].startByte;return n[o]instanceof Promise?n[o].then((t=>t.slice(e,f))):n[o].slice(e,f)}return n[o]}}}(e.file,t),t.groups.map((n=>function(e,{metadata:t,columns:n},r){const{file:i,compressors:o,utf8:f}=e,s=[],a={...p,...e.parsers};for(const{file_path:l,meta_data:c}of r.rowGroup.columns){if(l)throw new Error("parquet file_path not supported");if(!c)throw new Error("parquet column metadata is undefined");const u=c.path_in_schema[0];if(n&&!n.includes(u))continue;const{startByte:d,endByte:_}=le(c),p=_-d;if(p>1<<30){console.warn(`parquet skipping huge column "${c.path_in_schema}" ${p} bytes`);continue}const h=Promise.resolve(i.slice(d,_));s.push({pathInSchema:c.path_in_schema,data:h.then((n=>{const i=A(t.schema,c.path_in_schema),s={view:new DataView(n),offset:0},l={pathInSchema:c.path_in_schema,type:c.type,element:i[i.length-1].element,schemaPath:i,codec:c.codec,parsers:a,compressors:o,utf8:f};return $e(s,r,l,e.onPage)}))})}return{groupStart:r.groupStart,groupRows:r.groupRows,asyncColumns:s}}(e,t,n)))}function qe(e){return new Promise(((t,n)=>{Me({...e,rowFormat:"object",onComplete:t}).catch(n)}))}async function Ye(e){if(!(e.file&&e.file.byteLength>=0))throw new Error("parquet expected AsyncBuffer");e.metadata??=await k(e.file,e);const{metadata:t,rowStart:n=0,columns:r,orderBy:i,filter:o}=e;if(n<0)throw new Error("parquet rowStart must be positive");const f=e.rowEnd??Number(t.num_rows),s=Ce(o),a=z(e.metadata).children.map((e=>e.element.name)),l=s.filter((e=>!a.includes(e)));if(l.length)throw new Error(`parquet filter columns not found: ${l.join(", ")}`);if(i&&!a.includes(i))throw new Error(`parquet orderBy column not found: ${i}`);const c=r?a.filter((e=>r.includes(e)||s.includes(e)||e===i)):void 0,u=!(!r||!c)&&r.length<c.length;if(o&&!i&&f<t.num_rows){const i=new Array;let s=0;for(const n of t.row_groups){const t=s+Number(n.num_rows),a=await qe({...e,rowStart:s,rowEnd:t,columns:c});for(const e of a)if(se(e,o)){if(u&&c)for(const t of c)r&&!r.includes(t)&&delete e[t];i.push(e)}if(i.length>=f)break;s=t}return i.slice(n,f)}if(o){const t=await qe({...e,rowStart:void 0,rowEnd:void 0,columns:c});i&&t.sort(((e,t)=>Fe(e[i],t[i])));const s=new Array;for(const e of t)if(se(e,o)){if(u&&c)for(const t of c)r&&!r.includes(t)&&delete e[t];s.push(e)}return s.slice(n,f)}if("string"==typeof i){const t=await async function(e){if(1!==e.columns?.length)throw new Error("parquetReadColumn expected columns: [columnName]");e.metadata??=await k(e.file,e);const t=Ue(e),n=z(e.metadata),r=t.map((e=>Pe(e,n))),i=[];for(const e of r)i.push(fe(await e.asyncColumns[0].data));return fe(i)}({...e,rowStart:void 0,rowEnd:void 0,columns:[i]}),r=Array.from(t,((e,t)=>t)).sort(((e,n)=>Fe(t[e],t[n]))).slice(n,f),o=await async function(e){const{file:t,rows:n}=e;e.metadata??=await k(t,e);const{row_groups:r}=e.metadata,i=Array(r.length).fill(!1);let o=0;const f=r.map((e=>o+=Number(e.num_rows)));for(const e of n){i[f.findIndex((t=>e<t))]=!0}const s=[];let a;o=0;for(let e=0;e<i.length;e++){const t=o+Number(r[e].num_rows);i[e]?void 0===a&&(a=o):void 0!==a&&(s.push([a,t]),a=void 0),o=t}void 0!==a&&s.push([a,o]);const l=new Array(Number(e.metadata.num_rows));for(const[t,n]of s){const r=await qe({...e,rowStart:t,rowEnd:n});for(let e=t;e<n;e++)l[e]={__index__:e,...r[e-t]}}return l}({...e,rows:r});return r.map((e=>o[e]))}return await qe(e)}function Fe(e,t){return e<t?-1:e>t?1:0}function Ce(e){if(!e)return[];const t=[];return"$and"in e&&Array.isArray(e.$and)?t.push(...e.$and.flatMap(Ce)):"$or"in e&&Array.isArray(e.$or)?t.push(...e.$or.flatMap(Ce)):"$nor"in e&&Array.isArray(e.$nor)?t.push(...e.$nor.flatMap(Ce)):t.push(...Object.keys(e)),t}export{ie as asyncBufferFromUrl,re as byteLengthFromUrl,oe as cachedAsyncBuffer,fe as flatten,j as parquetMetadata,k as parquetMetadataAsync,Ye as parquetQuery,Me as parquetRead,qe as parquetReadObjects,z as parquetSchema,W as readColumnIndex,J as readOffsetIndex,Ne as snappyUncompress,Z as toJson};export default null;
